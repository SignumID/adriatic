"undefined"==typeof Banka&&(Banka={});mixin=function(a){for(var b={},d=0;d<arguments.length;d++)for(var c in arguments[d])b[c]=arguments[d][c];return b};"undefined"==typeof Banka.Mixins&&(Banka.Mixins={});
Banka.Mixins.Observable={addListener:function(a){"undefined"==typeof this.listeners&&(this.listeners=[]);for(var b=0;b<this.listeners.length;b++)if(this.listeners[b]==a)return;this.listeners[this.listeners.length]=a},removeListener:function(a){for(var b=0;b<this.listeners.length;b++)if(this.listeners[b]==a){this.listeners.splice(b,1);break}},notifyListeners:function(a,b){if("undefined"!=typeof this.listeners)for(var d=0;d<this.listeners.length;d++)if("undefined"!=typeof this.listeners[d][a])this.listeners[d][a](b)}};
"undefined"==typeof Banka.Map&&(Banka.Map={});Banka.Map.LocationDataCache=function(a){this.data={};this.dataSort={};"undefined"!=typeof a&&this.storeData(a)};
Banka.Map.LocationDataCache.prototype={clearCache:function(){this.data={};this.dataSort={}},storeData:function(a){for(var b=0;b<a.length;b++)if(this.data[a[b].id]=a[b],this.processData(this.data[a[b].id]),"category"in a[b]&&(a[b].category in this.dataSort||(this.dataSort[a[b].category]=[]),this.dataSort[a[b].category].push(a[b].id)),"subcategory"in a[b]){var d=[];Array.isArray(a[b].subcategory)?d=a[b].subcategory:d.push(a[b].subcategory);for(var c=0;c<d.length;c++)d[c]in this.dataSort||(this.dataSort[d[c]]=
[]),this.dataSort[d[c]].push(a[b].id)}},processData:function(a){a.id=a.id.toString();a.type="red"},getDataById:function(a){return"undefined"!=typeof this.data[a]?this.data[a]:null},getDataByCategory:function(a){var b=[];if(a in this.dataSort){for(var d=0;d<this.dataSort[a].length;d++)b.push(this.getDataById(this.dataSort[a][d]));return b}return null},getDataBySubcategories:function(a,b){if(Array.isArray(b)){if(a in this.dataSort){for(var d=[],c=0;c<this.dataSort[a].length;c++)for(var e=0;e<b.length;e++)if(this.isLocationInSubcategory(this.dataSort[a][c],
b[e])){d.push(this.getDataById(this.dataSort[a][c]));break}return d}return null}return this.getDataByCategory(b)},getIdsFromData:function(a){return a.map(function(a){return a.id})},isLocationInSubcategory:function(a,b){return b in this.dataSort&&-1!=$.inArray(a,this.dataSort[b])?!0:!1}};
Banka.Map.Model=function(a,b,d){this.zoom=!0;this.startId=0;this.locationsUrl=a;this.location=null;this.selectedCategory="undefined"==typeof d?null:d;this.selectedLocation=null;this.categories=[];this.subcategories={};this.subcategoryVisiblity={};this.categoryLoaded={};for(a=0;a<b.length;a++)if(this.categories.push(b[a].name),"subcategories"in b[a])for(this.subcategories[b[a].name]=b[a].subcategories,d=0;d<b[a].subcategories.length;d++)this.subcategoryVisiblity[b[a].subcategories[d]]=!0;else this.subcategories[b[a].name]=
null;this.cache=new Banka.Map.LocationDataCache;this.init()};
Banka.Map.Model.prototype=mixin(Banka.Mixins.Observable,{init:function(){var a=this;window.onpopstate=function(b){a.updateContentFromHistory(b.state)};Banka.Map.Geolocation.getCurrentLocation().then(function(a){if(null!=this.listeners[2].elements.data_search){a=this.listeners[2].elements.data_search;this.location=this.listeners[2].elements.data_search;var b=[3,4],c=this.listeners[2].elements.page_name;if("gradj"==c)b=[2];else if("mapod"==c||"svpod"==c)b=[3,4];this.setSubcategory("Poslovnica",b)}else{if(null!=
this.listeners[2].elements.page_name){b=[2,3,4];c=this.listeners[2].elements.page_name;if("gradj"==c)b=[2];else if("mapod"==c||"svpod"==c)b=[3,4];this.setSubcategory("Poslovnica",b)}this.location=a}this.notifyListeners("onNewLocation",a);null!==this.selectedCategory&&this.getLocationsData(this.selectedCategory)}.bind(this))},updateContentFromHistory:function(a){null!=a&&this.setCategoryFromHistory(a)},resetSubcategoriesVisibility:function(a){if(this.hasSubcategories(a)){a=this.getSubcategories(a);
for(var b=0;b<a.length;b++)this.subcategoryVisiblity[a[b]]=!0}},setSubcategoryVisibility:function(a,b){if(this.hasSubcategories(a))for(var d=this.getSubcategories(a),c=0;c<d.length;c++)for(var e=0;e<b.length;e++)if(d[c]==b[e]){this.subcategoryVisiblity[d[c]]=!0;break}else this.subcategoryVisiblity[d[c]]=!1},isCategoryDataLoaded:function(a){return a in this.categoryLoaded?!0:!1},setCategoryDataLoaded:function(a){this.categoryLoaded[a]=!0},clearCategoryDataLoaded:function(){this.categoryLoaded={}},
getCategories:function(){return this.categories},hasSubcategories:function(a){return null===this.subcategories[a]?!1:!0},getSubcategories:function(a,b){switch(a){case "Bankomati":a="Bankomat";break;case "Poslovnice":a="Poslovnica";break;case "Branches":a="Poslovnica";break;case "ATMs":a="Bankomat";break;case "Other":a="Ostalo"}if(!this.hasSubcategories(a))return[];if("undefined"==typeof b)return this.subcategories[a];for(var d=[],c=0;c<this.subcategories[a].length;c++)this.subcategoryVisiblity[this.subcategories[a][c]]===
b&&d.push(this.subcategories[a][c]);return d},isSubcategoryVisible:function(a){return this.subcategoryVisiblity[a]},hideSubcategory:function(a){null!==this.selectedLocation&&this.cache.isLocationInSubcategory(this.selectedLocation,a)&&this.unselectLocation();this.subcategoryVisiblity[a]=!1;this.notifyListeners("onSubcategoryFilterChange",{selected:this.getSubcategories(this.selectedCategory,!0),unselected:this.getSubcategories(this.selectedCategory,!1)})},showSubcategory:function(a){this.subcategoryVisiblity[a]=
!0;this.notifyListeners("onSubcategoryFilterChange",{selected:this.getSubcategories(this.selectedCategory,!0),unselected:this.getSubcategories(this.selectedCategory,!1)})},clearLocation:function(){this.location=null;this.notifyListeners("onClearLocation",null)},setNewLocation:function(a){this.categoryLoaded={};this.subcategoryLoaded={};this.unselectLocation();this.location=a;this.cache.clearCache();this.notifyListeners("onNewLocation",a);this.notifyListeners("getCurrentLocation",a);this.getLocationsData(this.selectedCategory);
this.notifyListeners("hereMarkerListener")},getSelectedCategory:function(a){return this.selectedCategory},setCategoryFromHistory:function(a,b){this.notifyListeners("displayActive",a);switch(event.state){case "Bankomati":a="Bankomat";break;case "Poslovnice":a="Poslovnica";break;case "Branches":a="Poslovnica";break;case "ATMs":a="Bankomat";break;case "Other":a="Ostalo"}this.unselectLocation();this.selectedCategory=a;this.notifyListeners("onCategoryChange",this.selectedCategory);"undefined"!=typeof b&&
b&&this.resetSubcategoriesVisibility(a);this.getLocationsDataFromDragg(this.listeners[5].map.getBounds())},setCategory:function(a,b){0<window.j.indexOf("/en")?history.pushState(a,a,window.j+"/map/"+a):history.pushState(a,a,window.j+"/mapa/"+a);this.unselectLocation();switch(a){case "Bankomati":a="Bankomat";break;case "Poslovnice":a="Poslovnica";break;case "Branches":a="Poslovnica";break;case "ATMs":a="Bankomat";break;case "Other":a="Ostalo"}this.selectedCategory=a;this.notifyListeners("onCategoryChange",
this.selectedCategory);"undefined"!=typeof b&&b&&this.resetSubcategoriesVisibility(a);this.getLocationsDataFromDragg(this.listeners[5].map.getBounds())},setSubcategory:function(a,b){this.unselectLocation();this.setSubcategoryVisibility(a,b);this.selectedCategory!=a&&(this.selectedCategory=a,this.notifyListeners("onCategoryChange",this.selectedCategory));this.getLocationsDataFromDragg(this.listeners[5].map.getBounds());this.notifyListeners("onSubcategoryFilterChange",{selected:this.getSubcategories(a,
!0),unselected:this.getSubcategories(a,!1)})},setMobileSubcategory:function(a,b){this.unselectLocation();switch(a){case "Bankomati":a="Bankomat";break;case "Poslovnice":a="Poslovnica";break;case "Branches":a="Poslovnica";break;case "ATMs":a="Bankomat";break;case "Other":a="Ostalo"}this.setSubcategoryVisibility(a,b);this.selectedCategory!=a&&(this.selectedCategory=a,this.notifyListeners("onCategoryChange",this.selectedCategory));this.getLocationsDataFromDragg(this.listeners[5].map.getBounds())},unsetCategory:function(){this.selectedCategory=
null},setLastId:function(a){this.startId=a},clearMarkersDragg:function(){this.notifyListeners("clearMarkers");this.cache.clearCache();this.clearCategoryDataLoaded()},getLocationsDataFromDragg:function(a){this.clearMarkersDragg();$.extend({},this.location);var b=[];b.push(this.selectedCategory);b={broj:10,vrstaPoslovnice:this.subcategories.Poslovnica,vrstaBankomata:this.subcategories.Bankomat,vrstaOstalo:this.subcategories.Ostalo,sveOstalo:[],vrsta:this.selectedCategory,vrstaPoi:b};podrucje={x1:a.getSouthWest().lat(),
y1:a.getSouthWest().lng(),x2:a.getNorthEast().lat(),y2:a.getNorthEast().lng()};areaInfo={podrucje:podrucje,filter:b,center:{lat:a.getCenter().lat(),lng:a.getCenter().lng()}};a=window.j.endsWith("/en")?window.j+"/map/podrucjeZaba":window.j+"/mapa/podrucjeZaba";$.ajax({url:a,method:"POST",data:JSON.stringify(areaInfo),contentType:"application/json; charset\x3dutf-8",success:function(a){this.notifyListeners("hide");if(null!==a.obj&&void 0!==a.obj&&0<a.obj.length){for(var b=a.obj.length,d=0;d<b;d++)a.obj[d].id=
d+this.startId,a.obj[d].category=this.selectedCategory,a.obj[d].address=a.obj[d].adresa,a.obj[d].lat=a.obj[d].geolat,a.obj[d].lng=a.obj[d].geolon,a.obj[d].open="",a.obj[d].phone="",a.obj[d].pois&&(a.obj[d].subcategory=this.setSubCategoryFromAjaxData(a.obj[d].pois)),a.obj[d].title=a.obj[d].adresa;this.setLastId(this.startId+b);this.cache.storeData(a.obj);this.notifyListeners("onLocationsLoad",{list_data:this.cache.getDataByCategory(this.selectedCategory),marker_data:this.getMarkerData(this.selectedCategory),
isMapBound:!1})}}.bind(this)})},getLocationsData:function(a){this.clearMarkersDragg();if(null!==this.location)if(this.isCategoryDataLoaded(a))this.notifyListeners("onLocationsLoad",{list_data:this.cache.getDataByCategory(a),marker_data:this.getMarkerData(a),isMapBound:!0});else{var b=$.extend({},this.location);b.category=a;var d=[];d.push(a);var c=this.subcategories.Bankomat,e=this.subcategories.Poslovnica,d={broj:10,vrstaPoslovnice:e,vrstaBankomata:c,vrstaOstalo:this.subcategories.Ostalo,sveOstalo:[],
vrsta:a,vrstaPoi:d};JSON.stringify({vrsta:a,vrstaBankomata:c,vrstaPoslovnice:e});b=JSON.stringify({lb:b.lat,mb:b.lng,nazivObjekt:a,filter:d});$.ajax({url:this.locationsUrl,method:"POST",data:b,contentType:"application/json; charset\x3dutf-8",success:function(b){if(null!==b.obj&&void 0!==b.obj&&0<b.obj.length){for(var c=b.obj.length,d=0;d<c;d++)b.obj[d].id=d+this.startId,b.obj[d].category=this.selectedCategory,b.obj[d].address=b.obj[d].adresa,b.obj[d].lat=b.obj[d].geolat,b.obj[d].lng=b.obj[d].geolon,
b.obj[d].open="",b.obj[d].phone="",b.obj[d].subcategory=this.setSubCategoryFromAjaxData(b.obj[d].pois),b.obj[d].title=b.obj[d].adresa;this.setLastId(this.startId+c);this.setCategoryDataLoaded(this.selectedCategory);this.cache.storeData(b.obj);this.notifyListeners("onLocationsLoad",{list_data:this.cache.getDataByCategory(a),marker_data:this.getMarkerData(a),isMapBound:!0})}}.bind(this)})}},setSubCategoryFromAjaxData:function(a){for(var b=a.length,d=[],c=0;c<b;c++)d.push(a[c].idFunkcija);return d},
getMarkerData:function(a){return this.hasSubcategories(a)?this.cache.getDataBySubcategories(a,this.getSubcategories(a,!0)):this.cache.getDataByCategory(a)},selectLocationId:function(a){for(var b in this.cache.data)if(this.cache.data[b].id==a){this.selectLocation(this.cache.data[b]);break}},selectLocation:function(a){this.unselectLocation();if(this.selectedLocation!=a.id){var b=this.selectedLocation;this.selectedLocation=a.id;this.notifyListeners("onSelect",{old:b,"new":a})}},unselectLocation:function(){null!==
this.selectedLocation&&(this.notifyListeners("onUnselect",this.selectedLocation),this.selectedLocation=null)},getSelectedLocation:function(){return this.selectedLocation},isLocationInSubcategory:function(a,b){return this.cache.isLocationInSubcategory(a,b)},getDataById:function(a){return this.cache.getDataById(a)},getDummyData:function(a,b){for(var d=Math.floor(50*Math.random()+1),c=[],e=0;e<d;e++){var f={id:e,category:a,lat:this.location.lat+(.5>Math.random()?1:-1)*Math.random()/2,lng:this.location.lng+
(.5>Math.random()?1:-1)*Math.random()/2,title:""+locationMapSearch.lokacija+" "+e,address:""+locationMapSearch.adresa+" "+e,phone:"01/ 111 111",open:""+locationMapSearch.ponPet+"\x3cbr /\x3e08h - 16h"};if(this.hasSubcategories(a)){var g=1+Math.floor(Math.random()*b.length-1E-11),h=JSON.parse(JSON.stringify(b));h.sort(function(){return.5-Math.random()});h.slice(0,g);f.subcategory=1<g?h.slice(0,g):h[0];"undefined"==typeof this.idCounter&&(this.idCounter=1);f.id=this.idCounter;this.idCounter++}c.push(f)}return c}});
Banka.Map.LocationSearchComponent=function(a,b){this.mapModel=b;this.elements=a;this.mapModel.addListener(this);this.suggestionListVisible=!1;this.locationSuggestionList=null;this.init()};
Banka.Map.LocationSearchComponent.prototype={init:function(){var a=this;this.elements.container.on("submit",function(a){a.preventDefault()});this.elements.input_field.on("keyup",function(b){a.updateClearButton();13==b.which?a.setSearch(a.elements.input_field.val()):a.suggestionListVisible&&a.hideList()});this.elements.submit_btn.on("click",function(b){b.preventDefault();a.setSearch(a.elements.input_field.val())});this.elements.input_field.on("keydown",function(b){!a.suggestionListVisible||9!=b.which&&
40!=b.which||(b.preventDefault(),$(".autocomplete-item").eq(0).focus())});this.elements.clear_btn.on("click",function(){a.elements.input_field.val("");a.updateClearButton();a.mapModel.clearLocation()});this.elements.list.on("click",".autocomplete-item",function(b){b.preventDefault();a.selectListItem($(this).index())});this.elements.list.on("keydown",".autocomplete-item",function(b){40==b.which&&(b.preventDefault(),$(this).next().focus());38==b.which&&(b.preventDefault(),$(this).prev().focus());if(13==
b.which||32==b.which)b.preventDefault(),a.selectListItem($(this).index())})},setSearch:function(a){var b=this;Banka.Map.Geolocation.getLocation(a).then(function(a){b.mapModel.setNewLocation(a[0]);b.hideList()}).catch(function(a){b.mapModel.setNewLocation({name:"Zagreb",city:"Zagreb",lat:45.815011,lng:15.981919})})},updateClearButton:function(){this.elements.input_field.val().length?this.elements.clear_btn.addClass("visible"):this.elements.clear_btn.removeClass("visible")},showList:function(){this.elements.list.addClass("active");
this.elements.container.addClass("has-bg");this.suggestionListVisible=!0;this.initList()},hideList:function(){this.elements.list.removeClass("active");this.elements.container.removeClass("has-bg");this.suggestionListVisible=!1;this.uninitList()},selectListItem:function(a){this.mapModel.setNewLocation(this.locationSuggestionList[a]);this.hideList()},initList:function(){var a=this;window.setTimeout(function(){$(window.document).on("click.suggestionListOutsideClick",function(b){$(b.target).closest(a.elements.container).length||
a.hideList()})},1)},uninitList:function(){$(window.document).off("click.suggestionListOutsideClick")},clearList:function(){this.elements.list.html("")},renderList:function(a){var b,d,c;b=this.elements.input_field.val();this.clearList();for(var e=0;e<a.length;e++)c=a[e].name.toLowerCase().indexOf(b),-1!=c?(d=a[e].name.substring(0,c),d+='\x3cspan class\x3d"autocomplete-highlight"\x3e'+a[e].name.substring(c,c+b.length)+"\x3c/span\x3e",d+=a[e].name.substring(c+b.length)):d=a[e].name,$('\x3cli class\x3d"autocomplete-item" tabindex\x3d"'+
e+'"\x3e'+d+"\x3c/li\x3e").appendTo(this.elements.list)},onNewLocation:function(a){this.elements.input_field.val(a.name);this.updateClearButton()}};Banka.Map.LocationListComponent=function(a,b){this.elements=a;this.mapModel=b;this.mapModel.addListener(this)};
Banka.Map.LocationListComponent.prototype={show:function(){this.elements.container.addClass("active");this.elements.search_container.addClass("active");this.elements.empty_state.addClass("hidden")},hide:function(){this.elements.container.removeClass("active");this.elements.search_container.removeClass("active");this.elements.empty_state.removeClass("hidden")},onNewLocation:function(a){this.hide()},onLocationsLoad:function(a){this.show()},onClearLocation:function(){this.hide()}};
Banka.Map.LocationList=function(a,b){this.elements=a;this.mapModel=b;this.mapModel.addListener(this);this.initHandlers()};
Banka.Map.LocationList.prototype={clear:function(){this.elements.container.html("")},getItemHtml:function(a){var b='\x3cli class\x3d"loc-list-item js-location-list-item" data-id\x3d"'+a.id+'"\x3e\x3ca class\x3d"loc-list-item-control"\x3e\x3ch4 class\x3d"loc-list-item-name"\x3e'+a.title;return b+='\x3c/h4\x3e\x3cdiv class\x3d"loc-list-item-address"\x3e'+a.grad+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e"},initHandlers:function(){var a=this;this.elements.container.on("click",".js-location-list-item",function(){a.mapModel.selectLocationId($(this).attr("data-id"))})},
onNewLocation:function(a){this.clear()},onLocationsLoad:function(a){this.clear();if(this.mapModel.hasSubcategories(this.mapModel.getSelectedCategory()))var b=this.mapModel.cache.getDataBySubcategories(this.mapModel.getSelectedCategory(),this.mapModel.getSubcategories(this.mapModel.getSelectedCategory(),!0)),b=this.mapModel.cache.getIdsFromData(b);for(var d=0;d<a.list_data.length;d++){var c=$(this.getItemHtml(a.list_data[d]));this.elements.container.append(c);this.mapModel.hasSubcategories(this.mapModel.getSelectedCategory())?
-1!=b.indexOf(a.list_data[d].id)?c.show():c.hide():c.show()}},onClearLocation:function(){this.clear()},onCategoryChange:function(a){this.clear();this.mapModel.zoom=!1},onSubcategoryFilterChange:function(a){a=this.mapModel.cache.getDataBySubcategories(this.mapModel.getSelectedCategory(),a.selected);var b=this.mapModel.cache.getIdsFromData(a);$(".js-location-list-item").each(function(a,c){-1!=b.indexOf($(c).attr("data-id"))?$(c).show():$(c).hide()})}};
Banka.Map.LocationInfoPanel=function(a,b){this.elements=a;this.mapModel=b;this.prviNonStop=!0;this.mapModel.addListener(this);this.init()};
Banka.Map.LocationInfoPanel.prototype={init:function(){var a=this;this.elements.close_button.on("click",function(){a.mapModel.unselectLocation()})},open:function(a){this.prviNonStop=!0;locationID=a.id;var b=this;void 0!==a.model?a.model.cache.data.hasOwnProperty(a.id)&&(c=a.model.cache.data[a.id]):c=a;var d=c.category;b.elements.content_container.html("");var c;a={lb:c.lng,mb:c.lat};c=window.j.endsWith("/en")?window.j+"/map/getPOI":window.j+"/mapa/getPOI";$.ajax({url:c,method:"POST",data:JSON.stringify(a),
contentType:"application/json; charset\x3dutf-8",success:function(a){$.ajax({url:window.j+"/modal/ajax_info_panel",method:"get",dataType:"html",success:function(c){b.elements.content_container.html(this.editHTML(c,a,d));b.show();initAccordion()}.bind(b)})}});return event.preventDefault()},hide:function(){this.elements.window.removeClass("active")},show:function(){this.elements.window.addClass("active")},onUnselect:function(){this.hide()},onSelect:function(a){this.open(a.new)},editHTML:function(a,
b,d){a=$(a);a.find(".info-panel-title").html(b.obj.adresa+", "+b.obj.grad);for(var c=0;c<b.obj.pois.length;c++)if(2==b.obj.pois[c].idFunkcija)a.find("#PoslovnicaGradjani")[0].style.display="block",a.find(".accordion-content-wrap")[0].insertAdjacentHTML("beforeend",this.setInfoPanelContent(b.obj.pois[c].nazivFunkcija,b.obj.pois[c].telefon,b.obj.pois[c].radnoVrijeme,b.obj.pois[c].webStatus,b.obj.pois[c].invalid,b.obj.pois[c].idFunkcija,b.obj.pois[c].dostupnost));else if(3==b.obj.pois[c].idFunkcija)a.find("#PoslovnicaPoduzetnici")[0].style.display=
"block",a.find(".accordion-content-wrap")[1].insertAdjacentHTML("beforeend",this.setInfoPanelContent(b.obj.pois[c].nazivFunkcija,b.obj.pois[c].telefon,b.obj.pois[c].radnoVrijeme,b.obj.pois[c].webStatus,b.obj.pois[c].invalid,b.obj.pois[c].idFunkcija,b.obj.pois[c].dostupnost));else if(4==b.obj.pois[c].idFunkcija)a.find("#PoduzetnickiCentar")[0].style.display="block",a.find(".accordion-content-wrap")[2].insertAdjacentHTML("beforeend",this.setInfoPanelContent(b.obj.pois[c].nazivFunkcija,b.obj.pois[c].telefon,
b.obj.pois[c].radnoVrijeme,b.obj.pois[c].webStatus,b.obj.pois[c].invalid,b.obj.pois[c].idFunkcija,b.obj.pois[c].dostupnost));else if(1>=b.obj.pois[c].idFunkcija||4<b.obj.pois[c].idFunkcija)a.find("#Ostalo")[0].style.display="block",a.find(".accordion-content-wrap")[3].insertAdjacentHTML("beforeend",this.setInfoPanelContent(b.obj.pois[c].nazivFunkcija,b.obj.pois[c].telefon,b.obj.pois[c].radnoVrijeme,b.obj.pois[c].webStatus,b.obj.pois[c].invalid,b.obj.pois[c].idFunkcija,b.obj.pois[c].dostupnost));b=
a.find(".accordion-content-wrap");var e=b.length;if("Poslovnica"==d)for(c=0;c<e;c++){if(0<b[c].textContent.trim().length||0<b[c].innerText.trim().length){b[c].className+=" active";break}}else if("Bankomat"==d)if(0<b[3].textContent.trim().length||0<b[2].innerText.trim().length)b[3].className+=" active";else for(c=0;c<e;c++){if(0<b[c].textContent.trim().length||0<b[c].innerText.trim().length){b[c].className+=" active";break}}else if("Ostalo"==d)if(0<b[3].textContent.trim().length||0<b[2].innerText.trim().length)b[3].className+=
" active";else for(c=0;c<e;c++)if(0<b[c].textContent.trim().length||0<b[c].innerText.trim().length){b[c].className+=" active";break}return a},setInfoPanelContent:function(a,b,d,c,e,f,g){radnoVrijeme={bankomat:!1,prviBank:!1,html:""};var h="";void 0==b&&null==b||""===b||(b=b.split(";"),h="\x3ch4\x3e"+locationMapSearch.telefon+"\x3c/h4\x3e"+b+"\x3cbr\x3e");b="";!d||0< !d.length||4<=f&&2>=f?(b='\x3cdiv class\x3d"open-status not-open"\x3e'+locationMapSearch.trenutnoNeRadi+"\x3c/div\x3e",0==c?b="":2==
c&&(b='\x3cdiv class\x3d"open-status not-open"\x3e'+locationMapSearch.trenutnoNeRadiUplata+"\x3c/div\x3e")):4>=f&&2<=f&&1==c&&(b='\x3cdiv class\x3d"open-status not-open"\x3e'+locationMapSearch.trenutnoNeRadi+"\x3c/div\x3e");c="";0<e&&(c='\x3ci title\x3d"Pristup za invalide" class\x3d"icon-accessible"\x3e\x3c/i\x3e');d&&0<d.length&&2<=f&&4>=f?radnoVrijeme.html=this.setRadnoVrijeme(b,d):radnoVrijeme=this.setSamousluzniTime(radnoVrijeme,g,b);return(radnoVrijeme.prviBank?['\x3cdiv class\x3d"accordion-content"\x3e',
radnoVrijeme.html+"\x3cbr\x3e","\x3ch4\x3e"+a+"\x3c/h4\x3e",c,"\x3c/div\x3e"]:radnoVrijeme.bankomat?['\x3cdiv class\x3d"accordion-content"\x3e',radnoVrijeme.html,"\x3ch4\x3e"+a+"\x3c/h4\x3e",c,"\x3c/div\x3e"]:['\x3cdiv class\x3d"accordion-content"\x3e',h,"\x3cdiv\x3e\x3cbr\x3e"+radnoVrijeme.html+"\x3c/div\x3e",c,"\x3c/div\x3e"]).join(" ")},setNonStop:function(a){this.prviNonStop=a},setSamousluzniTime:function(a,b,d){0==b?this.prviNonStop?(this.setNonStop(!1),a.html='\x3cdiv\x3e\x3ch4 class\x3d"open-title"\x3e'+
locationMapSearch.radnoVrijeme+" \x3c/h4\x3e"+d+"\x3c/div\x3e\x3cp\x3e0-24h\x3c/p\x3e",a.prviBank=!0):a.html="":this.prviNonStop?(this.setNonStop(!1),a.html='\x3cdiv\x3e\x3ch4 class\x3d"open-title"\x3e'+locationMapSearch.radnoVrijeme+"\x3c/h4\x3e"+d+"\x3cp\x3e"+locationMapSearch.uRadnoVrijemeObjekta+"\x3c/p\x3e\x3c/div\x3e",a.prviBank=!0):a.html="";a.bankomat=!0;return a},setRadnoVrijeme:function(a,b){var d=document.createElement("table"),c;for(c in b)switch(b[c].dan){case 0:0==b[c].f1h&&0==b[c].t1h&&
0==b[c].f2h&&0==b[c].t2h?$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.ponedjeljak+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e"+locationMapSearch.neRadi+"\x3c/td\x3e\x3c/tr\x3e"):$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.ponedjeljak+": \x26nbsp\x3c/td\x3e\x3ctd\x3e "+b[c].f1hString+":"+b[c].f1mString+"-"+b[c].t1hString+":"+b[c].t1mString+(0!==b[c].f2h||0!==b[c].f2m||0!==b[c].t2h||0!==b[c].t2m?" "+b[c].f2hString+":"+b[c].f2mString+"-"+
b[c].t2hString+":"+b[c].t2mString:"\x3c/td\x3e\x3c/tr\x3e"));break;case 1:0==b[c].f1h&&0==b[c].t1h&&0==b[c].f2h&&0==b[c].t2h?$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.utorak+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e"+locationMapSearch.neRadi+"\x3c/td\x3e\x3c/tr\x3e"):$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.utorak+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e "+b[c].f1hString+":"+b[c].f1mString+"-"+b[c].t1hString+":"+b[c].t1mString+(0!==b[c].f2h||
0!==b[c].f2m||0!==b[c].t2h||0!==b[c].t2m?" "+b[c].f2hString+":"+b[c].f2mString+"-"+b[c].t2hString+":"+b[c].t2mString:"\x3c/td\x3e\x3c/tr\x3e"));break;case 2:0==b[c].f1h&&0==b[c].t1h&&0==b[c].f2h&&0==b[c].t2h?$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.srijeda+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e"+locationMapSearch.neRadi+"\x3c/td\x3e\x3c/tr\x3e"):$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.srijeda+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e "+
b[c].f1hString+":"+b[c].f1mString+"-"+b[c].t1hString+":"+b[c].t1mString+(0!==b[c].f2h||0!==b[c].f2m||0!==b[c].t2h||0!==b[c].t2m?" "+b[c].f2hString+":"+b[c].f2mString+"-"+b[c].t2hString+":"+b[c].t2mString:"\x3c/td\x3e\x3c/tr\x3e"));break;case 3:0==b[c].f1h&&0==b[c].t1h&&0==b[c].f2h&&0==b[c].t2h?$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.cetvrtak+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e"+locationMapSearch.neRadi+"\x3c/td\x3e\x3c/tr\x3e"):$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+
locationMapSearch.cetvrtak+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e "+b[c].f1hString+":"+b[c].f1mString+"-"+b[c].t1hString+":"+b[c].t1mString+(0!==b[c].f2h||0!==b[c].f2m||0!==b[c].t2h||0!==b[c].t2m?" "+b[c].f2hString+":"+b[c].f2mString+"-"+b[c].t2hString+":"+b[c].t2mString:"\x3c/td\x3e\x3c/tr\x3e"));break;case 4:0==b[c].f1h&&0==b[c].t1h&&0==b[c].f2h&&0==b[c].t2h?$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.petak+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e"+locationMapSearch.neRadi+
"\x3c/td\x3e\x3c/tr\x3e"):$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.petak+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e "+b[c].f1hString+":"+b[c].f1mString+"-"+b[c].t1hString+":"+b[c].t1mString+(0!==b[c].f2h||0!==b[c].f2m||0!==b[c].t2h||0!==b[c].t2m?" "+b[c].f2hString+":"+b[c].f2mString+"-"+b[c].t2hString+":"+b[c].t2mString:"\x3c/td\x3e\x3c/tr\x3e"));break;case 5:0==b[c].f1h&&0==b[c].t1h&&0==b[c].f2h&&0==b[c].t2h?$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+
locationMapSearch.subota+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e"+locationMapSearch.neRadi+"\x3c/td\x3e\x3c/tr\x3e"):$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.subota+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e "+b[c].f1hString+":"+b[c].f1mString+"-"+b[c].t1hString+":"+b[c].t1mString+(0!==b[c].f2h||0!==b[c].f2m||0!==b[c].t2h||0!==b[c].t2m?" "+b[c].f2hString+":"+b[c].f2mString+"-"+b[c].t2hString+":"+b[c].t2mString:"\x3c/td\x3e\x3c/tr\x3e"));break;case 6:0==b[c].f1h&&0==b[c].t1h&&
0==b[c].f2h&&0==b[c].t2h?$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.nedjelja+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e"+locationMapSearch.neRadi+"\x3c/td\x3e\x3c/tr\x3e"):$(d).append('\x3ctr\x3e\x3ctd style\x3d"text-align:right"\x3e'+locationMapSearch.nedjelja+" : \x26nbsp\x3c/td\x3e\x3ctd\x3e "+b[c].f1hString+":"+b[c].f1mString+"-"+b[c].t1hString+":"+b[c].t1mString+(0!=b[c].f2h||0!==b[c].f2m||0!==b[c].t2h||0!==b[c].t2m?" "+b[c].f2hString+":"+b[c].f2mString+"-"+b[c].t2hString+
":"+b[c].t2mString:"\x3c/td\x3e\x3c/tr\x3e"))}return'\x3ch4 class\x3d"open-title"\x3e'+locationMapSearch.radnoVrijeme+"\x3c/h4\x3e"+a+d.outerHTML}};Banka.Map.LocationListCategorySelector=function(a,b){this.elements=a;this.mapModel=b;this.mapModel.addListener(this);this.init()};
Banka.Map.LocationListCategorySelector.prototype={init:function(){var a=this;this.displayActive(this.mapModel.getSelectedCategory());this.elements.selectors.on("click",function(b){b.preventDefault();a.mapModel.getSelectedCategory()!==$(this).attr("data-category")&&a.setActive($(this).attr("data-category"))})},displayActive:function(a){this.elements.selectors.removeClass("active").attr("aria-expanded","false");if(0<window.j.indexOf("/en"))switch(a){case "Poslovnica":a="Branches";break;case "Bankomat":a=
"ATMs";break;case "Ostalo":a="Other"}else switch(a){case "Poslovnica":a="Poslovnice";break;case "Bankomat":a="Bankomati";break;case "Ostalo":a="Ostalo"}this.elements.selectors.filter('[data-category\x3d"'+a+'"]').addClass("active").attr("aria-expanded","true")},setActive:function(a){this.displayActive(a);this.mapModel.setCategory(a)}};Banka.Map.LocationListSubcategorySelector=function(a,b){this.elements=a;this.mapModel=b;this.mapModel.addListener(this);this.opened=!1;this.init()};
Banka.Map.LocationListSubcategorySelector.prototype={init:function(){var a=this;null!==this.mapModel.getSelectedCategory()&&(this.setSelector(this.mapModel.getSelectedCategory()),this.update());this.elements.activator.on("click",function(){a.opened?a.close():a.open()});$("input",this.elements.subcategory_lists).on("click",function(b){b=$(this).attr("data-subcategory");a.mapModel.isSubcategoryVisible(b)?a.mapModel.hideSubcategory(b):a.mapModel.showSubcategory(b)})},setSelector:function(a){this.elements.subcategory_lists.attr("aria-expanded",
"false").removeClass("active");this.elements.subcategory_lists.filter('[data-category\x3d"'+a+'"]').addClass("active").attr("aria-expanded","true")},getSubcategorySelectorElement:function(a){return $('input[data-subcategory\x3d"'+a+'"]',this.elements.subcategory_lists)},update:function(){$("input",this.elements.subcategory_lists).prop("checked",!1);for(var a=this.mapModel.getSubcategories(this.mapModel.getSelectedCategory(),!0),b=0;b<a.length;b++)this.getSubcategorySelectorElement(a[b]).prop("checked",
!0)},open:function(){this.opened=!0;this.elements.activator.addClass("active").attr("aria-expanded","true");this.elements.subcategory_lists_container.addClass("active").attr("aria-expanded","true")},close:function(){this.opened=!1;this.elements.activator.attr("aria-expanded","false").removeClass("active");this.elements.subcategory_lists_container.attr("aria-expanded","false").removeClass("active")},onCategoryChange:function(a){this.close();this.mapModel.hasSubcategories(a)?this.elements.activator.css({visibility:"visible"}):
this.elements.activator.css({visibility:"hidden"});this.update();window.setTimeout(function(){this.setSelector(a)}.bind(this),300)}};Banka.Map.CategorySelectorMobileComponent=function(a,b){this.mapModel=b;this.elements=a;this.init()};
Banka.Map.CategorySelectorMobileComponent.prototype={init:function(){var a=this;this.elements.category_selectors.on("click",function(b){b.preventDefault();b=$(this).attr("data-category");var d=$(this).attr("data-subcategory");"undefined"!=typeof d?a.mapModel.setMobileSubcategory(b,d):(a.mapModel.resetSubcategoriesVisibility(b),a.mapModel.setCategory(b));a.hide()});this.elements.back_button.on("click",function(){a.show()})},hide:function(){this.elements.wrapper.addClass("active")},show:function(){this.elements.wrapper.removeClass("active")}};
Banka.Map.MapListToggleMobileComponent=function(a,b){this.elements=a;this.listDisplayOn=!1;this.mapModel=b;this.mapModel.addListener(this);this.init()};
Banka.Map.MapListToggleMobileComponent.prototype={init:function(){var a=this;this.elements.button.on("click",function(b){a.listDisplayOn?(a.elements.list_wrapper.removeClass("active"),$(this).removeClass("active")):(a.elements.list_wrapper.addClass("active"),$(this).addClass("active"));a.listDisplayOn=!a.listDisplayOn})},onSelect:function(){this.listDisplayOn&&(this.listDisplayOn=!1,this.elements.list_wrapper.removeClass("active"),this.elements.button.removeClass("active"))}};
Banka.Map.Geolocation={_getCityFromGeocodingResult:function(a){for(var b=0;b<a.address_components.length;b++)if(-1!=$.inArray("locality",a.address_components[b].types))return a.address_components[b].long_name;return""},getCurrentLocation:function(){var a=this;return new Promise(function(b,d){function c(){b({name:"Zagreb",city:"Zagreb",lat:45.815011,lng:15.981919})}navigator.geolocation?navigator.geolocation.getCurrentPosition(function(c){(new google.maps.Geocoder).geocode({location:{lat:c.coords.latitude,
lng:c.coords.longitude}},function(d,e){var f={name:"",city:"",lat:c.coords.latitude,lng:c.coords.longitude,accurate:!0};e===google.maps.GeocoderStatus.OK&&0<d.length&&(f.name=d[0].formatted_address,f.city=a._getCityFromGeocodingResult(d[0]));b(f)})},function(){c()}):c()})},getLocation:function(a){var b=this;return new Promise(function(d,c){var e=[];(new google.maps.Geocoder).geocode({address:a},function(a,g){if(g==google.maps.GeocoderStatus.OK){for(var f=0;f<a.length;f++)e.push({name:a[f].formatted_address,
city:b._getCityFromGeocodingResult(a[f]),lat:a[f].geometry.location.lat(),lng:a[f].geometry.location.lng(),accurate:!0});d(e)}else g==google.maps.GeocoderStatus.ZERO_RESULTS?c(Error("Location not found")):c(Error("Google maps error"))})})}};
Banka.Map.MapViewGeneric=function(a,b,d,c){this.model=a;this.elements=b;this.map=null;this.markers={};this.settings={};this.setSettings(c);this.clusterer=null;null!==d&&this.displayMarkers(d,!0);this.model.addListener(this);this.hereMarker=null;this.hereMarkerLat=this.hereMarkerLng=0};
Banka.Map.MapViewGeneric.prototype={default_settings:{single_marker_zoom_level:16,location_on_map_zoom_level:16,default_zoom_level:15,clustering:!0},init:function(){var a=this,b=this.map.getZoom();this.settings.clustering&&this.initMarkerClusterer();google.maps.event.addListener(this.map,"dragend",function(b){a.getMarkersForArea()});google.maps.event.addListener(this.map,"zoom_changed",function(){11>a.map.getZoom()&&a.map.setZoom(11);var d=a.map.getZoom();b>d&&a.model.zoom&&a.getMarkersForArea();
a.model.zoom=!0;b=a.map.getZoom()})},getMarkersForArea:function(){area=this.map.getBounds();this.model.getLocationsDataFromDragg(area);this.setHereMarker()},initMarkerClusterer:function(){null===this.clusterer&&("undefined"==typeof MarkerClusterer&&alert("Please install MarkerClusterer (https://github.com/googlemaps/js-marker-clusterer)"),this.clusterer=new MarkerClusterer(this.map,[],{maxZoom:12,gridSize:80,enableRetinaIcons:!0,styles:[{anchorIcon:[27,27],url:window.windowjs+"/static/img/cluster.png",
height:54,width:54,textColor:"black",textSize:15}]}))},setSettings:function(){this.settings=JSON.parse(JSON.stringify(this.default_settings));if("undefined"!=typeof settings)for(var a in settings)this.settings[a]=settings[a]},setStyle:function(){var a=new google.maps.StyledMapType([{stylers:[{saturation:-100}]},{featureType:"poi.business",stylers:[{visibility:"off"}]}],{name:"Google Map"});this.map.mapTypes.set("map_style",a);this.map.setMapTypeId("map_style")},displayMap:function(a,b){"undefined"==
typeof b&&(b=this.settings.default_zoom_level);null===this.map?(this.map=new google.maps.Map(this.elements.container[0],{center:a,zoom:b,streetViewControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeId:google.maps.MapTypeId.SATELLITE,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_BOTTOM},mapTypeControl:!1,panControl:!1}),this.setStyle(),this.init()):
google.maps.event.trigger(this.map,"resize")},hereMarkerListener:function(){var a=this;null!=a.hereMarker&&a.hereMarker.setMap(null);a.hereMarker=null;a.hereMarker=new google.maps.Marker({id:"tusamMarker",position:new google.maps.LatLng(a.model.location.lat,a.model.location.lng),map:this.map,draggable:!0,title:locationMapSearch.tuSam});google.maps.event.addListener(this.hereMarker,"dragend",function(b){a.hereMarkerLat=b.latLng.lat();a.hereMarkerLng=b.latLng.lng();a.getMarkersForArea();a.getLocationByCoordinates(a.hereMarker.position)})},
setHereMarker:function(){var a=this;null!=a.hereMarker?(a.hereMarker.id="tusamMarker",a.hereMarker.position=new google.maps.LatLng(a.hereMarkerLat,a.hereMarkerLng),a.hereMarker.map=this.map,a.hereMarker.draggable=!0,a.hereMarker.title=locationMapSearch.tuSam):(a.hereMarker=new google.maps.Marker({id:"tusamMarker",position:new google.maps.LatLng(a.model.location.lat,a.model.location.lng),map:this.map,draggable:!0,title:locationMapSearch.tuSam}),google.maps.event.addListener(this.hereMarker,"dragend",
function(b){a.hereMarkerLat=b.latLng.lat();a.hereMarkerLng=b.latLng.lng();a.getMarkersForArea();a.getLocationByCoordinates(a.hereMarker.position)}))},getLocationByCoordinates:function(a){var b=this;(new google.maps.Geocoder).geocode({latLng:a},function(a){a&&0<a.length&&b.model.setNewLocation({name:a[0].formatted_address,city:"",lat:b.hereMarkerLat,lng:b.hereMarkerLng})})},setLocationIcon:function(){var a=this,b=document.createElement("div"),d=document.createElement("button");d.style.backgroundColor=
"#fff";d.style.border="none";d.style.outline="none";d.style.width="28px";d.style.height="28px";d.style.borderRadius="2px";d.style.boxShadow="0 1px 4px rgba(0,0,0,0.3)";d.style.cursor="pointer";d.style.marginRight="10px";d.style.padding="0px";d.title="Your Location";b.appendChild(d);var c=document.createElement("div");c.style.margin="5px";c.style.width="18px";c.style.height="18px";c.style.backgroundImage="url(https://maps.gstatic.com/tactile/mylocation/mylocation-sprite-1x.png)";c.style.backgroundSize=
"180px 18px";c.style.backgroundPosition="0px 0px";c.style.backgroundRepeat="no-repeat";c.id="you_location_img";d.appendChild(c);google.maps.event.addListener(a.map,"dragend",function(){$("#you_location_img").css("background-position","0px 0px")});d.addEventListener("click",function(){var b=0!=a.hereMarkerLat||0!=a.hereMarkerLng?new google.maps.LatLng(a.hereMarkerLat,a.hereMarkerLng):new google.maps.LatLng(a.model.location.lat,a.model.location.lng);a.map.panTo(b);a.getMarkersForArea()});b.index=1;
a.map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(b)},displayMarkers:function(a,b){null==this.hereMarker?(this.setHereMarker(),this.setLocationIcon()):this.setHereMarker();for(var d,c=0;c<a.length;c++)a[c].id in this.markers||(d=new google.maps.LatLng(a[c].lat,a[c].lng),this.markers[a[c].id]=new Banka.Map.MapMarker(this.model,a[c].id,d,a[c].type),this.settings.clustering&&null!==this.clusterer?this.clusterer.addMarker(this.markers[a[c].id].marker):this.markers[a[c].id].addToMap(this.map));
1==Object.keys(this.markers).length?(d=Object.keys(this.markers)[0],this.displayMap(this.markers[d].marker.getPosition(),this.settings.single_marker_zoom_level)):"undefined"!=typeof b&&1!=b||this.setMapBounds()},setMapBounds:function(){var a=new google.maps.LatLng(this.model.location.lat,this.model.location.lng);this.map.panTo(a)},mapBounds:function(a){a=new google.maps.LatLng(a.lat,a.lng);this.map.panTo(a)},getMarker:function(a){return a in this.markers?this.markers[a]:null},zoomOutLocation:function(){var a=
new google.maps.LatLngBounds,b=0,d;for(d in this.markers)b++,a.extend(this.markers[d].marker.getPosition());1<b&&this.map.fitBounds(a)},zoomInLocation:function(a){a=a.id;"undefined"!=typeof this.markers[a]&&(this.map.setZoom(this.settings.location_on_map_zoom_level),this.map.setCenter(this.markers[a].marker.getPosition()),google.maps.event.trigger(this.map,"resize"))},fromLatLngToContainerPixel:function(a){var b=this.map.getBounds(),d=b.getNorthEast().lng()-b.getSouthWest().lng(),c=b.getSouthWest().lat()-
b.getNorthEast().lat(),e=a.lng()-b.getSouthWest().lng();a=a.lat()-b.getNorthEast().lat();b=this.getSize();return{x:Math.round(e*b.width/d),y:Math.round(a*b.height/c)}},getSize:function(){return{width:$(this.mapContainer).outerWidth(),height:$(this.mapContainer).outerHeight()}},clearMarkers:function(a){if("undefined"==typeof a){for(var b in this.markers)this.markers[b].uninit(),this.markers[b].removeFromMap();null!==this.clusterer&&this.clusterer.clearMarkers();this.markers={}}else for(b=0;b<a.length;b++)a[b]in
this.markers&&(this.markers[a[b]].removeFromMap(),this.settings.clustering&&null!==this.clusterer&&this.clusterer.removeMarker(this.markers[a[b]].marker),delete this.markers[a[b]])},onNewLocation:function(a){this.displayMap(new google.maps.LatLng(a.lat,a.lng),this.settings.default_zoom_level)},onLocationsLoad:function(a){this.clearMarkers();this.displayMarkers(a.marker_data,a.isMapBound)},onSelect:function(a){a.new.id in this.markers&&this.markers[a.new.id].setSelected()},onUnselect:function(a){a in
this.markers&&this.markers[a].setUnselected()}};Banka.Map.MapView=function(a,b,d,c){Banka.Map.MapViewGeneric.call(this,a,b,d,c)};
Banka.Map.MapView.prototype=Object.create(Banka.Map.MapViewGeneric.prototype,{constructor:{value:Banka.Map.MapView,configurable:!0,enumerable:!0,writeable:!1},onSubcategoryFilterChange:{value:function(a){a=this.model.cache.getDataBySubcategories(this.model.getSelectedCategory(),a.selected);var b=this.model.cache.getIdsFromData(a),d=Object.keys(this.markers);a=a.filter(function(a){return-1==d.indexOf(a.id)});var c=d.filter(function(a){return-1==b.indexOf(a.toString())});this.clearMarkers(c);this.displayMarkers(a,
!0)},configurable:!0,enumerable:!0,writeable:!0},onSelect:{value:function(a){this.zoomInLocation(a.new);Banka.Map.MapViewGeneric.prototype.onSelect.call(this,a)},configurable:!0,enumerable:!0,writeable:!0},onUnselect:{value:function(a){Banka.Map.MapViewGeneric.prototype.onUnselect.call(this,a)},configurable:!0,enumerable:!0,writeable:!0}});
Banka.Map.MapMarker=function(a,b,d,c){this.id=b;this.model=a;this.type=c;a={position:d,icon:Banka.Map.DataSettings.getIcon(c)};this.marker=new google.maps.Marker(a);this.handlers={mouseout:null,mouseover:null,click:null};this.init()};
Banka.Map.MapMarker.prototype={addToMap:function(a){this.marker.setMap(a)},removeFromMap:function(){this.marker.setMap(null)},setSelected:function(){this.marker.setIcon(Banka.Map.DataSettings.getIcon(this.type,"selected"))},setUnselected:function(){this.marker.setIcon(Banka.Map.DataSettings.getIcon(this.type))},init:function(){var a=this;this.handlers.click=google.maps.event.addListener(this.marker,"click",function(){a.model.getSelectedLocation()!=a.id?a.model.selectLocation(a):a.model.unselectLocation()})},
uninit:function(){google.maps.event.removeListener(this.handlers.click)}};Banka.Map.MapObjectBaloonViewGeneric=function(a,b){this.model=a;this.objectId=this.infoBaloonOverlay=null;this.mapView=b;this.model.addListener(this)};
Banka.Map.MapObjectBaloonViewGeneric.prototype={hide:function(){null!==this.infoBaloonOverlay&&(this.infoBaloonOverlay.setMap(null),this.objectId=this.infoBaloonOverlay=null)},show:function(a){this.hide();this.infoBaloonOverlay=new Banka.Map.MarkerMapBaloon(a,this.mapView.getMarker(a.id).marker,this.getHtml(a),this.mapView,this);this.objectId=a;this.infoBaloonOverlay.setMap(this.mapView.map);this.initBaloonContent(a)},getHtml:function(a){return""},initBaloonContent:function(a){},onSelect:function(a){this.show(a.new)},
onUnselect:function(a){this.hide()}};Banka.Map.MapObjectBaloonView=function(a,b){Banka.Map.MapObjectBaloonViewGeneric.call(this,a,b)};
Banka.Map.MapObjectBaloonView.prototype=Object.create(Banka.Map.MapObjectBaloonViewGeneric.prototype,{getHtml:{value:function(a){a=this.model.getDataById(a);for(var b="\x3cp\x3e\x3cstrong\x3e"+a.title+"\x3c/strong\x3e\x3cbr /\x3e"+a.address+"\x3c/p\x3e",d=["phone","open"],c=[],e=0;e<d.length;e++)d[e]in a&&c.push(a[d[e]]);c&&(b+="\x3cp\x3e"+c.join("\x3cbr /\x3e")+"\x3c/p\x3e");return b},writeable:!0,enumerable:!1,configurable:!1}});
Banka.Map.MapObjectBaloonViewSelect=function(a,b,d,c){this.elements=a;this.modal=c;Banka.Map.MapObjectBaloonViewGeneric.call(this,b,d)};
Banka.Map.MapObjectBaloonViewSelect.prototype=Object.create(Banka.Map.MapObjectBaloonViewGeneric.prototype,{getHtml:{value:function(a){a=this.model.getDataById(a.id);var b;this.model.subcategoryVisiblity[2]&&this.model.subcategoryVisiblity[3]?b='\x3ch2 class\x3d"map-baloon-heading"\x3e'+locationMapSearch.poslovnica+"\x3cbr /\x3e"+locationMapSearch.gradaniPosSub+"\x3c/h2\x3e":this.model.subcategoryVisiblity[2]&&!this.model.subcategoryVisiblity[3]?b='\x3ch2 class\x3d"map-baloon-heading"\x3e'+locationMapSearch.poslovnica+
"\x3cbr /\x3e"+locationMapSearch.gradani+"\x3c/h2\x3e":this.model.subcategoryVisiblity[2]||(b='\x3ch2 class\x3d"map-baloon-heading"\x3e'+locationMapSearch.poslovnica+"\x3cbr /\x3e"+locationMapSearch.posSub+"\x3c/h2\x3e");b+="\x3cp\x3e\x3cstrong\x3e"+a.title+"\x3c/strong\x3e\x3cbr /\x3e"+a.address+"\x3c/p\x3e";for(var d=["phone","open"],c=[],e=0;e<d.length;e++)d[e]in a&&c.push(a[d[e]]);c&&(b+="\x3cp\x3e"+c.join("\x3cbr /\x3e")+"\x3c/p\x3e");return b+='\x3ca class\x3d"btn btn-blue js-baloon-select-office"\x3e'+
locationMapSearch.odaberi+"\x3c/a\x3e"},writeable:!0,enumerable:!1,configurable:!1},initBaloonContent:{value:function(a){var b=this,d=window.setInterval(function(){0<$(".js-baloon-select-office").length&&$(".js-baloon-select-office").click(function(){var c=b.model.getDataById(a.id);b.elements.office_input_field.val(c.grad+", "+c.address);var d="",f=c.pois.length;0<f&&b.elements.office_seleced_field.empty();for(var g=0;g<f;g++)"Poslovnica"==c.pois[g].vrsta&&(d+="\x3coption value\x3d'"+c.pois[g].idOrganizacije.trim()+
"'\x3e"+c.pois[g].nazivFunkcija+" "+c.pois[g].adresa+", "+c.pois[g].grad+"\x3c/option\x3e");b.elements.office_seleced_field.append(d);b.elements.office_fieldset.css("display","block");$(".js-close-button").click()});window.clearInterval(d)},50)},writeable:!0,enumerable:!1,configurable:!1}});
Banka.Map.MarkerMapBaloon=function(a,b,d,c,e){this.id=a;this.marker=b;this.html=d;this.baloonContentElement=this.baloonElement=this.containerElement=null;this.mapObject=c;this.mapBaloonManager=e;this.closeBaloonHandler=this.closeBaloonButton=null};Banka.Map.AutocompleteDataModel=function(a){"undefined"!=typeof a&&(this.options=a);this.data=[];this.filteredData=[];this.currentQueryString=this.filterString=this.suggestionLoadString=null;this.isLoading=!1};
Banka.Map.AutocompleteDataModel.prototype=mixin(Banka.Mixins.Observable,{options:{suggestion_activation_input_length:3,sugesstion_ajax_url:"js/map_data.json"},getSuggestionText:function(a){var b=this.getSuggestions();return a<b.length?b[a].value:""},getSuggestionId:function(a){var b=this.getSuggestions();return a<b.length?b[a].data:null},getAjaxQueryData:function(){return{q:this.suggestionLoadString}},getSearchTerm:function(){return this.filterString},loadSuggestions:function(a){var b=this;0==this.isLoading&&
(this.isLoading=!0,this.suggestionLoadString=a.toLowerCase().substring(0,b.options.suggestion_activation_input_length),$.ajax({dataType:"json",url:this.options.sugesstion_ajax_url,data:this.getAjaxQueryData(),success:function(d){0==b.currentQueryString.indexOf(b.suggestionLoadString)?(b.isLoading=!1,b.data=d,a.length>b.options.suggestion_activation_input_length&&b.filterSuggestions(a),b.notifyListeners("onSuggestionChange",b.getSuggestions())):b.loadSuggestions(b.currentQueryString)}}))},filterSuggestions:function(a){this.filteredData=
[];a=a.toLowerCase();for(var b=0;b<this.data.length;b++)-1<this.data[b].value.toLowerCase().latinise().indexOf(a.latinise())&&this.filteredData.push(b)},getSuggestions:function(){if(this.filterString==this.suggestionLoadString)return this.data;for(var a=[],b=0;b<this.filteredData.length;b++)a.push(this.data[this.filteredData[b]]);return a},update:function(a){this.currentQueryString!=a.toLowerCase()&&(this.currentQueryString=a.toLowerCase(),this.currentQueryString.length<this.options.suggestion_activation_input_length?
this.notifyListeners("onSuggestionChange",[]):this.currentQueryString.length==this.options.suggestion_activation_input_length?(this.filterString=a.toLowerCase(),this.currentQueryString==this.suggestionLoadString?this.notifyListeners("onSuggestionChange",this.data):this.loadSuggestions(this.currentQueryString)):(this.filterString=a.toLowerCase(),0==this.filterString.indexOf(this.suggestionLoadString)?(this.filterSuggestions(this.currentQueryString),this.notifyListeners("onSuggestionChange",this.getSuggestions())):
this.loadSuggestions(this.currentQueryString)))}});Banka.Map.AutocompleteComponent=function(a,b,d){this.autocompleteModel=b;this.elements=a;this.autocompleteModel.addListener(this);this.suggestionListVisible=!1;this.selectFunction=d;this.init()};
Banka.Map.AutocompleteComponent.prototype={init:function(){var a=this;this.elements.input_field.on("keyup",function(b){a.autocompleteModel.update(a.elements.input_field.val())});this.elements.input_field.on("keydown",function(b){if(a.suggestionListVisible){if(9==b.which||40==b.which)b.preventDefault(),$(".autocomplete-item").eq(0).focus();27==b.which&&(b.preventDefault(),a.hideList(),a.elements.input_field.focus())}});this.elements.list.on("click",".autocomplete-item",function(b){b.preventDefault();
a.selectListItem($(this).index())});this.elements.list.on("keydown",".autocomplete-item",function(b){40==b.which&&(b.preventDefault(),$(this).next().focus());38==b.which&&(b.preventDefault(),$(this).prev().focus());if(13==b.which||32==b.which)b.preventDefault(),a.selectListItem($(this).index())})},showList:function(){this.elements.list.addClass("active");this.suggestionListVisible=!0;this.initList()},hideList:function(){this.elements.list.removeClass("active");this.suggestionListVisible=!1;this.uninitList()},
selectListItem:function(a){"gradoviFunction"==this.selectFunction?this.gradoviFunction(a):"locFunction"==this.selectFunction?this.locFunction(a):"gradoviNatjecajFunction"==this.selectFunction?this.gradoviNatjecajFunction(a):"bankeFunction"==this.selectFunction?this.bankeFunction(a):this.select(a)},locFunction:function(a){this.elements.input_field.val(this.autocompleteModel.getSuggestionText(a));findLoc(this.elements.input_field.val(),this);this.hideList()},gradoviFunction:function(a){this.elements.input_field.val(this.autocompleteModel.getSuggestionText(a));
findOffice(this.elements.input_field.val(),this);this.hideList()},bankeFunction:function(a){this.elements.input_field.val(this.autocompleteModel.getSuggestionText(a));this.hideList()},gradoviNatjecajFunction:function(a){0!=this.autocompleteModel.getSuggestionText(a).length&&this.elements.input_field.val(this.autocompleteModel.getSuggestionText(a));this.hideList()},select:function(a){this.elements.input_field.val(this.autocompleteModel.getSuggestionText(a));this.elements.hidden_field.val(this.autocompleteModel.getSuggestionId(a));
this.hideList()},initList:function(){var a=this;window.setTimeout(function(){$(window.document).on("click.suggestionListOutsideClick",function(b){$(b.target).closest(a.elements.list).length||a.hideList()})},1)},uninitList:function(){$(window.document).off("click.suggestionListOutsideClick")},clearList:function(){this.elements.list.html("")},renderList:function(a){var b,d,c;b=this.autocompleteModel.getSearchTerm();this.clearList();for(var e=0;e<a.length;e++)c=a[e].value.toLowerCase().indexOf(b),-1!=
c?(d=a[e].value.substring(0,c),d+='\x3cspan class\x3d"autocomplete-highlight"\x3e'+a[e].value.substring(c,c+b.length)+"\x3c/span\x3e",d+=a[e].value.substring(c+b.length)):d=a[e].value,$('\x3cli class\x3d"autocomplete-item" tabindex\x3d"'+e+'"\x3e'+d+"\x3c/li\x3e").appendTo(this.elements.list)},onSuggestionChange:function(a){0==a.length?(this.clearList(),this.suggestionListVisible&&this.hideList()):(this.renderList(a),!1===this.suggestionListVisible&&this.showList())}};
function initGlobalGoogle(){Banka.Map.MarkerMapBaloon.prototype=new google.maps.OverlayView;Banka.Map.MarkerMapBaloon.prototype.onAdd=function(){this.createBaloonElements();this.getPanes().floatPane.appendChild(this.containerElement);this.addCloseBaloonHandler()};Banka.Map.MarkerMapBaloon.prototype.addCloseBaloonHandler=function(){var a=this;this.closeBaloonHandler=google.maps.event.addDomListener(this.closeBaloonButton,"click",function(){a.mapBaloonManager.model.unselectLocation();a.mapBaloonManager.hide()})};
Banka.Map.MarkerMapBaloon.prototype.removeHandlers=function(){google.maps.event.removeListener(this.closeBaloonHandler);this.closeBaloonHandler=null};Banka.Map.MarkerMapBaloon.prototype.onRemove=function(){this.removeHandlers();this.containerElement.parentNode.removeChild(this.containerElement)};Banka.Map.MarkerMapBaloon.prototype.draw=function(){var a;$(this.baloonContentElement).html(this.html);a=this.getBaloonPosition(10);$(this.containerElement).css({top:a.pos.y+"px",left:a.pos.x+"px"})};Banka.Map.MarkerMapBaloon.prototype.getBaloonPosition=
function(a){var b,d,c;this.mapObject.fromLatLngToContainerPixel(this.marker.getPosition());b=this.getProjection().fromLatLngToDivPixel(this.marker.getPosition());this.mapObject.getSize();this.marker.getIcon();this.marker.getIcon();d=this.marker.getIcon().anchor.y;c=b.x-Math.round($(this.containerElement).outerWidth()/2);a=b.y-a-d-$(this.containerElement).outerHeight();return{pos:{x:c,y:a}}};Banka.Map.MarkerMapBaloon.prototype.createBaloonElements=function(){this.containerElement=$('\x3cdiv class\x3d"map-baloon"\x3e\x3cdiv class\x3d"map-baloon-inner"\x3e\x3c/div\x3e\x3cdiv class\x3d"map-baloon-close"\x3e\x3c/div\x3e\x3c/div\x3e')[0];
this.baloonContentElement=$(".map-baloon-inner",this.containerElement)[0];this.closeBaloonButton=$(".map-baloon-close",this.containerElement)[0]};Banka.Map.DataSettings={categories:[{name:"Poslovnica",subcategories:[2,3,4]},{name:"Bankomat",subcategories:[0,1]},{name:"Ostalo",subcategories:[5,7,6]}],markers:{red:{default:{url:window.windowjs+"/static/img/red.png",size:new google.maps.Size(72,92),scaledSize:new google.maps.Size(36,46),anchor:new google.maps.Point(18,46)},selected:{url:window.windowjs+
"/static/img/red_selected.png",size:new google.maps.Size(72,92),scaledSize:new google.maps.Size(36,46),anchor:new google.maps.Point(18,46)}},blue:{icon:{url:window.windowjs+"/static/img/blue.png",size:new google.maps.Size(72,92),scaledSize:new google.maps.Size(36,46),anchor:new google.maps.Point(18,46)}}},getIcon:function(a,b){return"undefined"==typeof b||!b in Banka.Map.DataSettings.markers[a]?Banka.Map.DataSettings.markers[a].default:Banka.Map.DataSettings.markers[a][b]}}}
"undefined"!=typeof google&&initGlobalGoogle();